<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Perfil</title>
    <link
      rel="stylesheet"
      href="{{ url_for('transactions.static', filename='css/profile.css') }}"
    />
    <script src="{{ url_for('transactions.static', filename='js/profile.js') }}"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <div class="menu-topo">
          <ul>
            <li class="transactions-option-content">
              <img
                src="{{ url_for('transactions.static', filename='images/transacao.png') }}"
                alt="Transações"
              />
              <a href="{{ url_for('transactions.transactions_page') }}"
                >Transações</a
              >
            </li>
            <li class="dashboards-option-content">
              <img
                src="{{ url_for('transactions.static', filename='images/estatistica.png') }}"
                alt="Estatísticas"
              />
              <a href="#">Estatísticas</a>
            </li>
            <li class="settings-option-content">
              <img
                src="{{ url_for('transactions.static', filename='images/ajuste.png') }}"
                alt="Ajustes"
              />
              <a href="#">Ajustes</a>
            </li>
          </ul>
        </div>

        <div class="menu-rodape">
          <ul>
            <li class="logout-option-content">
              <img
                src="{{ url_for('transactions.static', filename='images/sair.png') }}"
                alt="Logout"
              />
              <a href="{{ url_for('users.logout') }}">Logout</a>
            </li>
          </ul>
        </div>
      </div>

      <div class="content">
        <div class="profile-pic">
          {% if user.avatar %}
          <img src="{{ user.avatar }}" alt="Avatar" />
          {% else %}
          <img
            src="{{ url_for('transactions.static', filename='images/user.png') }}"
            alt="Avatar"
          />
          {% endif %}
        </div>

        <div class="info">
          <div class="profile-header">
            <h2>Perfil</h2>
            <button id="edit-btn">
              <img
                src="{{ url_for('transactions.static', filename='images/edit_button.png') }}"
                alt="Editar"
              />
            </button>
          </div>

          <label>Nome</label>
          <input type="text" value="{{ user.name }}" disabled />

          <label>E-mail</label>
          <input type="text" value="{{ user.email }}" disabled />

          <label>Data de Nascimento</label>
          <input
            type="text"
            value="{{ user.birthday.strftime('%d/%m/%Y') }}"
            disabled
          />
        </div>
      </div>
    </div>

    <script>
      const nameInput = document.getElementById("name");
      const phoneInput = document.getElementById("phone");
      const editBtn = document.getElementById("edit-btn");
      const saveBtn = document.getElementById("save-btn");
      const cancelBtn = document.getElementById("cancel-btn");

      const originalValues = {
        name: nameInput.value,
        phone: phoneInput.value,
      };

      editBtn.addEventListener("click", () => {
        nameInput.disabled = false;
        phoneInput.disabled = false;

        editBtn.style.display = "none";
        saveBtn.style.display = "inline-block";
        cancelBtn.style.display = "inline-block";
      });

      cancelBtn.addEventListener("click", () => {
        nameInput.value = originalValues.name;
        phoneInput.value = originalValues.phone;
        nameInput.disabled = true;
        phoneInput.disabled = true;

        editBtn.style.display = "inline-block";
        saveBtn.style.display = "none";
        cancelBtn.style.display = "none";
      });

      saveBtn.addEventListener("click", async () => {
        const updatedData = {
          name: nameInput.value,
          phone: phoneInput.value,
        };

        const response = await fetch("/transactions/profile/update", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(updatedData),
        });

        const result = await response.json();

        if (result.success) {
          originalValues.name = updatedData.name;
          originalValues.phone = updatedData.phone;

          nameInput.disabled = true;
          phoneInput.disabled = true;
          editBtn.style.display = "inline-block";
          saveBtn.style.display = "none";
          cancelBtn.style.display = "none";
          alert(result.message);
        } else {
          alert(result.message);
        }
      });
    </script>
  </body>
</html>
